============================================================
  OTP EMAIL VERIFICATION SYSTEM TEST
============================================================

â³ Waiting for server...

â”€â”€ Test 1: Register â†’ Auto OTP Send â”€â”€
  âŒ Register returns 201 â€” status: 422
  âŒ requiresEmailVerification flag
  âŒ otpSent flag present
  âŒ JWT token returned
  â„¹ï¸  Dev OTP: (check server console)
  â„¹ï¸  Test email: otp-test-1772240581230@example.com

â”€â”€ Test 2: POST /api/auth/send-otp â”€â”€
  âŒ Send OTP returns 200 â€” status: 404
  âŒ expiresIn = 600
  â„¹ï¸  New Dev OTP: (check server console)

â”€â”€ Test 3: Cooldown (60s between sends) â”€â”€
  âŒ Second send within 60s â†’ 429 â€” status: 404
  âŒ retryAfter present â€” retryAfter: undefined
  â„¹ï¸  Retry after: undefineds

â”€â”€ Test 4: Wrong OTP â†’ 400 + attempts remaining â”€â”€
  âœ… Wrong OTP â†’ 400 â€” status: 400
  âŒ attemptsLeft present â€” attemptsLeft: undefined
  â„¹ï¸  Attempts left: undefined

â”€â”€ Test 5: Correct OTP â†’ 200 + email verified â”€â”€
  âš ï¸  No dev OTP available â€” skipping correct OTP tests
  â„¹ï¸  Check server console for OTP value

â”€â”€ Test 8: Input Validation â”€â”€
  âœ… Invalid email â†’ 422 â€” status: 422
  âœ… 5-digit OTP â†’ 422 â€” status: 422
  âœ… Non-numeric OTP â†’ 422 â€” status: 422

â”€â”€ Test 9: Non-existent email â”€â”€
  âœ… Non-existent email â†’ 404 â€” status: 404

â”€â”€ Cleanup â”€â”€

============================================================
  RESULTS: 5 passed, 12 failed
============================================================

âš ï¸  12 test(s) failed

ğŸ“‹ OTP System Summary:
  â€¢ OTP: 6-digit, crypto.randomInt (CSPRNG)
  â€¢ Storage: bcrypt hash (never plain text)
  â€¢ Expiry: 10 minutes
  â€¢ Cooldown: 60 seconds between resends
  â€¢ Max sends: 3 per hour per email
  â€¢ Max attempts: 5 per OTP
  â€¢ One-time use: deleted after successful verify
  â€¢ Timing-safe: bcrypt.compare (constant time)
  â€¢ Dev mode: OTP logged to console + returned in response
